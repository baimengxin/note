# wxml

```html
<!-- 筛选面板 HTML结构 -->
<view class="filter-panel">
  <!-- 价格区间 -->
  <view class="filter-item">
    <view class="filter-title">价格区间(元)</view>
    <input
      type="number"
      placeholder="最低价"
      bindinput="onMinPriceInput"
      value="{{minPrice}}"
    />
    <input
      type="number"
      placeholder="最高价"
      bindinput="onMaxPriceInput"
      value="{{maxPrice}}"
    />
  </view>

  <!-- 品牌选择 -->
  <view class="filter-item">
    <view class="filter-title">
      品牌
      <button bindtap="toggleExpand" data-type="brand">
        {{isBrandExpanded ? '收起' : '更多'}}
      </button>
    </view>
    <view class="filter-content">
      <block
        wx:for="{{isBrandExpanded ? sortedBrands : limitedSortedBrands}}"
        wx:key="brand"
      >
        <view
          class="filter-option {{selectedBrands.includes(item) ? 'selected' : ''}}"
          data-item="{{item}}"
          data-type="brand"
          bindtap="selectOption"
          >{{item}}</view
        >
      </block>
    </view>
  </view>

  <!-- 品类选择 -->
  <view class="filter-item">
    <view class="filter-title">
      品类
      <button bindtap="toggleExpand" data-type="category">
        {{isCategoryExpanded ? '收起' : '更多'}}
      </button>
    </view>
    <view class="filter-content">
      <block
        wx:for="{{isCategoryExpanded ? sortedCategories : limitedSortedCategories}}"
        wx:key="category"
      >
        <view
          class="filter-option {{selectedCategories.includes(item) ? 'selected' : ''}}"
          data-item="{{item}}"
          data-type="category"
          bindtap="selectOption"
          >{{item}}</view
        >
      </block>
    </view>
  </view>

  <!-- 尺码选择 -->
  <view class="filter-item">
    <view class="filter-title">
      尺码
      <button bindtap="toggleExpand" data-type="size">
        {{isSizeExpanded ? '收起' : '更多'}}
      </button>
    </view>
    <view class="filter-content">
      <block
        wx:for="{{isSizeExpanded ? sortedSizes : limitedSortedSizes}}"
        wx:key="size"
      >
        <view
          class="filter-option {{selectedSizes.includes(item) ? 'selected' : ''}}"
          data-item="{{item}}"
          data-type="size"
          bindtap="selectOption"
          >{{item}}</view
        >
      </block>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="filter-actions">
    <button bindtap="resetFilters">重置</button>
    <button bindtap="applyFilters">确定</button>
  </view>
</view>
```

```ts
Page({
  data: {
    minPrice: "",
    maxPrice: "",
    brands: ["品牌1", "品牌2", "品牌3", "品牌4", "品牌5", "品牌6"], // 示例数据
    categories: ["品类1", "品类2", "品类3", "品类4", "品类5", "品类6"], // 示例数据
    sizes: ["S", "M", "L", "XL", "XXL", "XXXL"], // 示例数据
    selectedBrands: [],
    selectedCategories: [],
    selectedSizes: [],
    isBrandExpanded: false,
    isCategoryExpanded: false,
    isSizeExpanded: false,
  },

  onLoad() {
    this.updateSortedOptions();
  },

  // 更新排序后的选项列表
  updateSortedOptions() {
    const {
      brands,
      categories,
      sizes,
      selectedBrands,
      selectedCategories,
      selectedSizes,
    } = this.data;

    const sortedBrands = this.sortSelectedToTop(brands, selectedBrands);
    const sortedCategories = this.sortSelectedToTop(
      categories,
      selectedCategories
    );
    const sortedSizes = this.sortSelectedToTop(sizes, selectedSizes);

    this.setData({
      sortedBrands,
      sortedCategories,
      sortedSizes,
      limitedSortedBrands: sortedBrands.slice(0, 6),
      limitedSortedCategories: sortedCategories.slice(0, 6),
      limitedSortedSizes: sortedSizes.slice(0, 6),
    });
  },

  // 将选中的项目置顶
  sortSelectedToTop(options, selectedOptions) {
    const selectedSet = new Set(selectedOptions);
    return [
      ...selectedOptions,
      ...options.filter((option) => !selectedSet.has(option)),
    ];
  },

  // 通用的选项选择处理函数
  selectOption(e) {
    const { item, type } = e.currentTarget.dataset;
    const selectedKey = `selected${
      type.charAt(0).toUpperCase() + type.slice(1)
    }s`; // e.g., selectedBrands
    let selectedItems = this.data[selectedKey];

    const index = selectedItems.indexOf(item);
    if (index === -1) {
      selectedItems.push(item);
    } else {
      selectedItems.splice(index, 1);
    }

    this.setData({ [selectedKey]: selectedItems }, this.updateSortedOptions);
  },

  // 通用的展开/收起处理函数
  toggleExpand(e) {
    const { type } = e.currentTarget.dataset;
    const expandKey = `is${
      type.charAt(0).toUpperCase() + type.slice(1)
    }Expanded`; // e.g., isBrandExpanded
    this.setData({ [expandKey]: !this.data[expandKey] });
  },

  // 输入价格区间
  onMinPriceInput(e) {
    this.setData({ minPrice: e.detail.value });
  },
  onMaxPriceInput(e) {
    this.setData({ maxPrice: e.detail.value });
  },

  // 重置筛选条件
  resetFilters() {
    this.setData(
      {
        minPrice: "",
        maxPrice: "",
        selectedBrands: [],
        selectedCategories: [],
        selectedSizes: [],
      },
      this.updateSortedOptions
    );
  },

  // 应用筛选条件
  applyFilters() {
    // 应用筛选逻辑
    console.log("筛选条件已应用", this.data);
  },
});
```

# 没优化前

```ts
Page({
  data: {
    minPrice: "",
    maxPrice: "",
    brands: ["品牌1", "品牌2", "品牌3", "品牌4", "品牌5", "品牌6"], // 示例数据
    categories: ["品类1", "品类2", "品类3", "品类4", "品类5", "品类6"], // 示例数据
    sizes: ["S", "M", "L", "XL", "XXL", "XXXL"], // 示例数据
    selectedBrands: [],
    selectedCategories: [],
    selectedSizes: [],
    isBrandExpanded: false,
    isCategoryExpanded: false,
    isSizeExpanded: false,
  },

  onLoad() {
    this.updateSortedOptions();
  },

  // 更新排序后的选项列表
  updateSortedOptions() {
    const {
      brands,
      categories,
      sizes,
      selectedBrands,
      selectedCategories,
      selectedSizes,
    } = this.data;

    const sortedBrands = this.sortSelectedToTop(brands, selectedBrands);
    const sortedCategories = this.sortSelectedToTop(
      categories,
      selectedCategories
    );
    const sortedSizes = this.sortSelectedToTop(sizes, selectedSizes);

    this.setData({
      sortedBrands,
      sortedCategories,
      sortedSizes,
      limitedSortedBrands: sortedBrands.slice(0, 6),
      limitedSortedCategories: sortedCategories.slice(0, 6),
      limitedSortedSizes: sortedSizes.slice(0, 6),
    });
  },

  // 将选中的项目置顶
  sortSelectedToTop(options, selectedOptions) {
    const selectedSet = new Set(selectedOptions);
    return [
      ...selectedOptions,
      ...options.filter((option) => !selectedSet.has(option)),
    ];
  },

  // 输入价格区间
  onMinPriceInput(e) {
    this.setData({ minPrice: e.detail.value });
  },
  onMaxPriceInput(e) {
    this.setData({ maxPrice: e.detail.value });
  },

  // 选择品牌
  selectBrand(e) {
    const brand = e.currentTarget.dataset.item;
    const selectedBrands = this.data.selectedBrands;
    const index = selectedBrands.indexOf(brand);
    if (index === -1) {
      selectedBrands.push(brand);
    } else {
      selectedBrands.splice(index, 1);
    }
    this.setData({ selectedBrands }, this.updateSortedOptions);
  },

  // 选择品类
  selectCategory(e) {
    const category = e.currentTarget.dataset.item;
    const selectedCategories = this.data.selectedCategories;
    const index = selectedCategories.indexOf(category);
    if (index === -1) {
      selectedCategories.push(category);
    } else {
      selectedCategories.splice(index, 1);
    }
    this.setData({ selectedCategories }, this.updateSortedOptions);
  },

  // 选择尺码
  selectSize(e) {
    const size = e.currentTarget.dataset.item;
    const selectedSizes = this.data.selectedSizes;
    const index = selectedSizes.indexOf(size);
    if (index === -1) {
      selectedSizes.push(size);
    } else {
      selectedSizes.splice(index, 1);
    }
    this.setData({ selectedSizes }, this.updateSortedOptions);
  },

  // 展开或收起品牌列表
  toggleBrandExpand() {
    this.setData({ isBrandExpanded: !this.data.isBrandExpanded });
  },

  // 展开或收起品类列表
  toggleCategoryExpand() {
    this.setData({ isCategoryExpanded: !this.data.isCategoryExpanded });
  },

  // 展开或收起尺码列表
  toggleSizeExpand() {
    this.setData({ isSizeExpanded: !this.data.isSizeExpanded });
  },

  // 重置筛选条件
  resetFilters() {
    this.setData(
      {
        minPrice: "",
        maxPrice: "",
        selectedBrands: [],
        selectedCategories: [],
        selectedSizes: [],
      },
      this.updateSortedOptions
    );
  },

  // 应用筛选条件
  applyFilters() {
    // 应用筛选逻辑
    console.log("筛选条件已应用", this.data);
  },
});
```
